---
title: "Spatial_analysis_clean"
author: "Aleah Wong"
date: '2024-09-11'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

############################################################################################
##TABLE OF CONTENTS
STEPS 1-4: See "Spatialdata_prep.Rmd"

STEP 5: Weighted FCB scores by continent

STEP 6: Case study countries

Visualization and analysis

############################################################################################

```{r Load in the saved data}

F_weighted_continent <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweighted_bycontinent.csv")
F_weighted_continent <- F_weighted_continent[, -c(1)]
C_weighted_continent <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweighted_bycontinent.csv")
C_weighted_continent <- C_weighted_continent[, -c(1)]
B_weighted_continent <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweighted_bycontinent.csv")
B_weighted_continent <- B_weighted_continent[, -c(1)]

F_weighted_country <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweighted_bycountry.csv")
F_weighted_country <- F_weighted_country[, -c(1)]
C_weighted_country <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweighted_bycountry.csv")
C_weighted_country <- C_weighted_country[, -c(1)]
B_weighted_country <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweighted_bycountry.csv")
B_weighted_country <- B_weighted_country[, -c(1)]
```

###STEP 5: 
```{r Trend lines over time--test}

#Continents
ggplot(F_weighted_continent, aes(x=Year, y=Score, color = Region)) +geom_line(size =1)+
  labs(y = "Mean F Index", title = "F Potential of Aquaculture", color = "Continent")+
    theme(axis.text.x = element_text(size = 10), axis.title.y = element_text(size=10))+
      scale_color_manual(values=c('#7D627F', '#BA714F', '#F4B9B2', '#C0E08F', '#7DBBC3', "orange"))

#Case study countries
ggplot(F_weighted_country, aes(x=Year, y=Score, color = Country)) +geom_line(size =1)+
  labs(y = "Mean F Index", title = "F Potential of Aquaculture", color = "Country")+
    theme(axis.text.x = element_text(size = 10), axis.title.y = element_text(size=10))+
      scale_color_manual(values=c('#7D627F', '#F4B9B2', '#C0E08F', '#7DBBC3'))+
  ylim(45, 60)+
  xlim(1960, 2021)
```

###Boxplots for three different time periods
```{r Graphing FCB score distribution in different time periods for continents}

means_3_periods <- F_weighted_continent

means_3_periods$Year[means_3_periods$Year >= 1950 & means_3_periods$Year <= 1980] <- "1950-1980_mean"
means_3_periods$Year[means_3_periods$Year >= 1981 & means_3_periods$Year <= 2000] <- "1981-2000_mean"
means_3_periods$Year[means_3_periods$Year >= 2001 & means_3_periods$Year <= 2021] <- "2001-2021_mean"

ggplot(means_3_periods, aes(x = Year, y=Score, color = Region))+ geom_boxplot()+
  scale_x_discrete(limits = c("1950-1980_mean", "1981-2000_mean", "2001-2021_mean"))+
  scale_y_continuous(limits = c(20, 66))

#boxplots for two different periods
now_then_means <- F_weighted_continent

now_then_means <- filter(now_then_means, Year %in% c(1980, 1981, 1982, 1983, 1984, 1985, 2016, 2017, 2018, 2019, 2020, 2021))

now_then_means$Year[now_then_means$Year == 1980 |now_then_means$Year == 1981 |now_then_means$Year == 1982 |now_then_means$Year == 1983 |now_then_means$Year == 1984 |now_then_means$Year == 1985] <- "1980-1985_mean"

now_then_means$Year[now_then_means$Year == 2016 |now_then_means$Year == 2017 |now_then_means$Year == 2018 |now_then_means$Year == 2019 |now_then_means$Year == 2020 |now_then_means$Year == 2021] <- "2016-2021_mean"

ggplot(now_then_means, aes(x = Year, y=Score, color = Region))+ geom_boxplot()+
  scale_x_discrete(limits = c("1980-1985_mean", "2016-2021_mean"))+
  scale_y_continuous(limits = c(20, 66))
```

```{r Graphing just the means}

mean_80_00 <- F_weighted_continent %>% group_by(Region) %>% 
  filter(Year >= 1980 & Year <= 2000) %>%
  summarise(mean_80_00 = mean(Score))

mean_00_21 <- weighted_indexes %>% group_by(Region) %>% 
  filter(Year >= 2000 & Year <= 2021) %>%
  summarise(mean_00_21 = mean(Score))

means_2_periods <- merge (mean_80_00, mean_00_21, by = c("Region"))

#make long
means_2_periods <- pivot_longer(means_2_periods, cols = c(!Region), 
                                names_to = "Period", values_to = "Mean")

#plotting
ggplot(means_2_periods, aes(x = Period, y=Mean, color = Region))+ geom_boxplot()+
  scale_x_discrete(limits = c("mean_80_00", "mean_00_21"))+
  scale_y_continuous(limits = c(30, 66))

# getwd()
#SAVE
# ggsave("mean_B_continent_3_periods.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set
```

##WORKING HERE...#see lines 554 in production_analysis_without_china or 1125 in prod_analysis_spatial_copy
```{r comparing last 5 years to baseline 1980-1985} 

#########comparing last 5 years to baseline 1980-1985############## #tinker with this...
#5-year average for each continent for: (1980-1985) and (2016-2021)

mean_80_85 <- F_weighted_continent %>% group_by(Region) %>% 
  filter(Year %in% c(1980, 1981, 1982, 1983, 1984, 1985)) %>%
  summarise(mean_80_85 = mean(Score))

mean_16_21 <- F_weighted_continent %>% group_by(Region) %>% 
  filter(Year %in% c( 2016, 2017, 2018, 2019, 2020, 2021)) %>%
  summarise(mean_16_21 = mean(Score))

means <- merge(mean_80_85, mean_16_21, by = c("Region"))

#make long
means <- pivot_longer(means, cols = c(!Region),
                                names_to = "Period", values_to = "Mean")


ggplot(means, aes(x = Period, y=Mean, color = Region))+ geom_boxplot()+
  scale_x_discrete(limits = c("mean_80_85", "mean_16_21"))
  # scale_y_continuous(limits = c(40, 70))

# ggsave("mean_C_continent_recent_vs_80.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set


#Trying a different baseline...

```

```{r ANOVA and post-hoc tests}
#to compare the means in three periods 

#to compare the means in the two periods:


```

###STEP 6? Case study countries
```{r Graphing FCB together since 1960? for each case study country}

```

#REMEMBER: only weight by one species of Porphyra (out of three species of Porphyra included in the FCB scores data), since the production data clumps them all together
