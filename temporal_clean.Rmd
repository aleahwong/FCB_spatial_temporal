---
title: "temporal_clean"
author: "Aleah Wong"
date: '2024-08-29'
output: html_document
---

```{r}
rm(list = ls())
.rs.restartR()
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(ggplot2)
```

```{r}
#Color palette with colorblind friendly colors

cbPalette1 <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

#use orange, yellow, dark blue, red and pink
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#D55E00", "#CC79A7")

tolpalettesub <- c("#DC267F", "#785EF0", "#648FFF")


# # To use for fills, add
#   scale_fill_manual(values=cbPalette)
# 
# # To use for line and point colors, add
#   scale_colour_manual(values=cbPalette)
```

############################################################
Steps 1-4 are stored in the dataprep file
1. Calculate annual production totals for each species (data saved/provided)
2. Clean species names and prepare dataset (data saved/provided)
3. Graphing production (don't need to run steps 1-2)
4. Calculating production by taxa--use production values to weight FCB scores by taxonomic category
-----------------------------------------------
5. Weight F scores by production
6. Weight C scores by production
7. Weight B scores by production
8. Graphing weighted FCB scores together
9. FCB Correlations over time
10. Graphing weighted FCB scores for each taxa
11. Correlations of FCB in species
############################################################

###STEP 5: Weight food security scores by production ###
```{r}
#checking the difference between these datasets 

# prodbytaxa_alpha <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/prodbytaxa_alphab.csv")
# prodbytaxa_clean <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/prodbytaxa_clean.csv") #has the category column
```

```{r Loading in data}

speciesdata <- read.csv("/Users/aleahw/Documents/Master's!!/Fuzzy/FCB_scores_2024.csv") #FCB scores for each species
speciesdata <- speciesdata[, c(2:12)] #remove extra first column
speciesdata <- speciesdata[order(speciesdata$species), ] #put in alphabetical order
speciesdata <- speciesdata[!speciesdata$species == "Eucheuma cottonii",] #remove E. Cottonii, as it is a duplicate

weighting_totals <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/prodbytaxa_forweighting.csv") #annual production by taxonomic group
weighting_totals <- weighting_totals[, c(2:74)] #remove extra first column

production_data <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/prodbytaxa_clean.csv") #annual production by species
production_data <- production_data[, c(2:75)] #remove extra first column

#load in this dataset to use as an empty frame, just species and year columns
frame <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/prodbytaxa_alphab.csv")
frame <- frame[, c(2:74)] #remove extra column
```

```{r FOOD SECURITY WEIGHTED BY ALL PRODUCTION}
#calculate index scores for each species weighted by production of ALL 55 species

new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

#loop through each species and multiply f score by (production of that species/production of all species)
#cat_totals (production in THOUSANDS of tons) and speciesdata (f scores) align

for (i in 1:nrow(speciesdata)){ #for each species
  print(speciesdata$species[i])
  f_score <- speciesdata$f[i] #get the score, CHANGE FOR B AND C
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[1, b-1]) #weight by production of ALL species
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata[i, 2]#include species
  } 
  
}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[57, i] <- a
}

new_frame[57, 1] <- "Weighted Index" #name the newest row
weighted_indexes <- new_frame[57, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes <- pivot_longer(weighted_indexes, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes <- weighted_indexes[order(weighted_indexes$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes)) {
  print(weighted_indexes$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes$Year[i] <- year_labs[i]
}

weighted_indexes$Year <- as.numeric(weighted_indexes$Year) #make years numeric

#SAVE this data to graph FCB together in step 8
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweightedby_all.csv")
# write.csv(weighted_indexes,file=NAME)
```

```{r FOOD SECURITY WEIGHTED BY FINFISH}
new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

#loop through each FINFISH species and multiply f score by (production of that species/production of all species)
#cat_totals (production in THOUSANDS of tons) and speciesdata (f scores) align

speciesdata2 <- filter(speciesdata, category == "finfish_inland" | category =="finfish_marine") #filter out just the finfish

production_data2 <- filter(production_data, category =="finfish_inland"| category =="finfish_marine")

for (i in 1:nrow(speciesdata2)){ #for each species
  f_score <- speciesdata2$f[i] #get the score #CHANGE THIS FOR B AND C
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[2, b-1]) #weight by production of finfish
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2] #include species
  } 
  
}

#calculate the annual mean each year
for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[57, i] <- a
}

new_frame[57, 1] <- "Weighted Index" #name the newest row
weighted_indexes1 <- new_frame[57, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes1 <- pivot_longer(weighted_indexes1, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes1 <- weighted_indexes1[order(weighted_indexes1$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes1)) {
  print(weighted_indexes1$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes1$Year[i] <- year_labs[i]
}

weighted_indexes1$Year <- as.numeric(weighted_indexes1$Year) #make years numeric

# SAVE this data to graph FCB together for finfish in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweightedby_finfish.csv")
# write.csv(weighted_indexes1,file=NAME)
```

```{r FOOD SECURITY WEIGHTED BY ALGAE}
new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

#loop through each ALGAE species and multiply f score by (production of that species/production of all species)
#production_data (production in THOUSANDS of tons) and speciesdata (f scores) align

speciesdata2 <- filter(speciesdata, category == "algae") #filter out just the algae

production_data2 <- filter(production_data, category =="algae")

for (i in 1:nrow(speciesdata2)){ #for each species
  # print(speciesdata$species[i])
  f_score <- speciesdata2$f[i] #get the score #CHANGE THIS FOR B AND C

  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[4, b-1]) #weight by production of algae, row 4

  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  }

}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)

    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes2 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes2 <- pivot_longer(weighted_indexes2, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes2 <- weighted_indexes2[order(weighted_indexes2$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes2)) {
  print(weighted_indexes2$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes2$Year[i] <- year_labs[i]
}

weighted_indexes2$Year <- as.numeric(weighted_indexes2$Year) #make years numeric

# SAVE this data to graph FCB together for algae in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweightedby_algae.csv")
# write.csv(weighted_indexes2,file=NAME)
```

```{r FOOD SECURITY WEIGHTED BY CRUSTACEANS and MOLLUSCS}
new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

speciesdata2 <- filter(speciesdata, category == "crustacean")

production_data2 <- filter(production_data, category == "crustacean")

for (i in 1:nrow(speciesdata2)){ #for each species
  f_score <- speciesdata2$f[i] #get the f score

  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[5, b-1]) #weight by production of crustaceans, row 5

  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  }

}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)

    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes3 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes3 <- pivot_longer(weighted_indexes3, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes3 <- weighted_indexes3[order(weighted_indexes3$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes3)) {
  print(weighted_indexes3$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes3$Year[i] <- year_labs[i]
}

weighted_indexes3$Year <- as.numeric(weighted_indexes3$Year) #make years numeric

# SAVE this data to graph FCB together for crustaceans in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweightedby_crustaceans.csv")
# write.csv(weighted_indexes3,file=NAME)
----------------------------------------------------------------------------------------------------
#MOLLUSCS
new_frame <- frame #create new frame
new_frame <- new_frame[FALSE, ]

speciesdata2 <- filter(speciesdata, category == "mollusc")

production_data2 <- filter(production_data, category == "mollusc")

for (i in 1:nrow(speciesdata2)){ #for each species
  f_score <- speciesdata2$f[i] #get the f score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[6, b-1]) #weight by production of molluscs, row 6
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  } 
  
}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes4 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes4 <- pivot_longer(weighted_indexes4, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes4 <- weighted_indexes4[order(weighted_indexes4$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes4)) {
  print(weighted_indexes4$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes4$Year[i] <- year_labs[i]
}

weighted_indexes4$Year <- as.numeric(weighted_indexes4$Year) #make years numeric

# SAVE this data to graph FCB together for molluscs in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweightedby_molluscs.csv")
# write.csv(weighted_indexes4,file=NAME)
```

```{r Graphing food security index over time with all taxa weightings}

setwd("/Users/aleahw/Documents/Master's!!/Chapter_2/Figures")

#weighted_indexes = weighted by all
#need to add identifier column
weighted_indexes$weighted_by <- "All"

#weighted_indexes1 = weighted by finfish
weighted_indexes1$weighted_by <- "Finfish"

#weighted_indexes2 = weighted by algae
weighted_indexes2$weighted_by <- "Algae"

#weighted_indexes3 = weighted by crustaceans
weighted_indexes3$weighted_by <- "Crustaceans"

#weighted_indexes4 = weighted by molluscs
weighted_indexes4$weighted_by <- "Molluscs"

#put into one dataframe, all stacked up
merge <- rbind(weighted_indexes, weighted_indexes1)
merge <- rbind(merge, weighted_indexes2)
merge <- rbind(merge, weighted_indexes3)
merge <- rbind(merge, weighted_indexes4)

#save this data
NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/weighted_Fscores.csv")
write.csv(merge,file=NAME)

#graph
ggplot(merge, aes(x=Year, y=Score, color = weighted_by)) +geom_line(size =1)+
  labs(y = "Mean Food Security Index", title = "Food Security Potential of Aquaculture")+
    theme(axis.text.x = element_text(size = 10), axis.title.y = element_text(size=10))+
      scale_color_manual(name = "Weighted By", values=c(cbPalette))+
    ylim(30,65)

#SAVE
# ggsave("F_weighted_combined830.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set
```

```{r}
#magnitude of F, C and B indices by taxonomic group in three time periods
# merge %>%
#   group_by(weighted_by) %>%
#   summarise(min = min(Score), max = max(Score))
```

```{r Graphing means}

setwd("/Users/aleahw/Documents/Master's!!/Chapter_2/Figures")

#modify dataset: create three time periods --> change this for C and B too
scores_3_periods <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/weighted_Fscores.csv")
scores_3_periods <- scores_3_periods[, c(2:4)] #remove extra column

#modify dataset: create three time periods
# scores_3_periods <- merge

scores_3_periods$Year[scores_3_periods$Year >= 1950 & scores_3_periods$Year <= 1980] <- "Early expansion"
scores_3_periods$Year[scores_3_periods$Year >= 1981 & scores_3_periods$Year <= 2000] <- "Intensification"
scores_3_periods$Year[scores_3_periods$Year >= 2001 & scores_3_periods$Year <= 2021] <- "Recent growth"

plot <- ggplot(scores_3_periods, aes(x = Year, y=Score, color = weighted_by))+ geom_boxplot()+
  stat_summary(fun.y=mean,geom='point', position = position_dodge(width = .75))+
  # stat_summary(fun=mean, geom="line", aes(group=weighted_by), position = position_dodge(width = .75))+
  scale_x_discrete(limits = c("Early expansion", "Intensification", "Recent growth"))+
  scale_y_continuous(limits = c(30, 67))+
  labs(y = "Mean Food Security Index")+
    theme(axis.text.x = element_text(size = 10), axis.title.x = element_blank(), axis.title.y = element_text(size=10))+
      scale_color_manual(name = "Weighted By", values= cbPalette)

# ggsave("mean_F_boxplots.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set
```

###STEP 6: Weight climate scores by production ###
```{r CLIMATE CHANGE WEIGHTED BY ALL PRODUCTION}
#calculate index scores for each species weighted by production of ALL 54 species

new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

#loop through each species and multiply f score by (production of that species/production of all species)
#cat_totals (production in THOUSANDS of tons) and speciesdata (f scores) align

for (i in 1:nrow(speciesdata)){ #for each species
  print(speciesdata$species[i])
  f_score <- speciesdata$c[i] #get the score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[1, b-1]) #weight by production of ALL species
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata[i, 2]#include species
  } 
  
}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes <- pivot_longer(weighted_indexes, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes <- weighted_indexes[order(weighted_indexes$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes)) {
  print(weighted_indexes$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes$Year[i] <- year_labs[i]
}

weighted_indexes$Year <- as.numeric(weighted_indexes$Year) #make years numeric

#save data to graph weighted FCB together in step 8
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweightedby_all.csv")
# write.csv(weighted_indexes,file=NAME)
--------------------------------------------------------
  
#CLIMATE CHANGE WEIGHTED BY FINFISH
new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

#loop through each FINFISH species and multiply f score by (production of that species/production of all species)
#cat_totals (production in THOUSANDS of tons) and speciesdata (f scores) align

speciesdata2 <- filter(speciesdata, category == "finfish_inland" | category =="finfish_marine") #filter out just the finfish

production_data2 <- filter(production_data, category =="finfish_inland"| category =="finfish_marine")

for (i in 1:nrow(speciesdata2)){ #for each species
  f_score <- speciesdata2$c[i] #get the score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[2, b-1]) #weight by production of finfish
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  } 
  
}

#calculate the annual mean each year
for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes1 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes1 <- pivot_longer(weighted_indexes1, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes1 <- weighted_indexes1[order(weighted_indexes1$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes1)) {
  print(weighted_indexes1$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes1$Year[i] <- year_labs[i]
}

weighted_indexes1$Year <- as.numeric(weighted_indexes1$Year) #make years numeric

# SAVE this data to graph FCB together for finfish in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweightedby_finfish.csv")
# write.csv(weighted_indexes1,file=NAME)
-----------------------------------------------------------------------------------------
  
#CLIMATE CHANGE WEIGHTED BY ALGAE
new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

#loop through each ALGAE species and multiply f score by (production of that species/production of all species)
#production_data (production in THOUSANDS of tons) and speciesdata (f scores) align

speciesdata2 <- filter(speciesdata, category == "algae") #filter out just the algae

production_data2 <- filter(production_data, category =="algae")

for (i in 1:nrow(speciesdata2)){ #for each species
  # print(speciesdata$species[i])
  f_score <- speciesdata2$c[i] #get the score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[4, b-1]) #weight by production of algae, row 4
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  } 
  
}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes2 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes2 <- pivot_longer(weighted_indexes2, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes2 <- weighted_indexes2[order(weighted_indexes2$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes2)) {
  print(weighted_indexes2$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes2$Year[i] <- year_labs[i]
}

weighted_indexes2$Year <- as.numeric(weighted_indexes2$Year) #make years numeric

# SAVE this data to graph FCB together for algae in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweightedby_algae.csv")
# write.csv(weighted_indexes2,file=NAME)
----------------------------------------------------------------------------------------------------
  
#CLIMATE CHANGE WEIGHTED BY CRUSTACEANS
new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

speciesdata2 <- filter(speciesdata, category == "crustacean")

production_data2 <- filter(production_data, category == "crustacean")

for (i in 1:nrow(speciesdata2)){ #for each species
  f_score <- speciesdata2$c[i] #get the c score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[5, b-1]) #weight by production of crustaceans, row 5
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  } 
  
}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes3 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes3 <- pivot_longer(weighted_indexes3, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes3 <- weighted_indexes3[order(weighted_indexes3$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes3)) {
  print(weighted_indexes3$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes3$Year[i] <- year_labs[i]
}

weighted_indexes3$Year <- as.numeric(weighted_indexes3$Year) #make years numeric

# SAVE this data to graph FCB together for crustaceans in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweightedby_crustaceans.csv")
# write.csv(weighted_indexes3,file=NAME)
----------------------------------------------------------------------------------------
#MOLLUSCS
new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

speciesdata2 <- filter(speciesdata, category == "mollusc")

production_data2 <- filter(production_data, category == "mollusc")

for (i in 1:nrow(speciesdata2)){ #for each species
  f_score <- speciesdata2$c[i] #get the c score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[6, b-1]) #weight by production of molluscs, row 6
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  } 
  
}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes4 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes4 <- pivot_longer(weighted_indexes4, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes4 <- weighted_indexes4[order(weighted_indexes4$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes4)) {
  print(weighted_indexes4$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes4$Year[i] <- year_labs[i]
}

weighted_indexes4$Year <- as.numeric(weighted_indexes4$Year) #make years numeric

# SAVE this data to graph FCB together for molluscs in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweightedby_molluscs.csv")
# write.csv(weighted_indexes4,file=NAME)
------------------------------------------------------------------------------------------------

#GRAPHING
#need to add identifier column
weighted_indexes$weighted_by <- "All"

#weighted_indexes1 = weighted by finfish
weighted_indexes1$weighted_by <- "Finfish"

#weighted_indexes2 = weighted by algae
weighted_indexes2$weighted_by <- "Algae"

#weighted_indexes3 = weighted by crustaceans
weighted_indexes3$weighted_by <- "Crustaceans"

#weighted_indexes4 = weighted by molluscs
weighted_indexes4$weighted_by <- "Molluscs"

#put into one dataframe, all stacked up
merge <- rbind(weighted_indexes, weighted_indexes1)
merge <- rbind(merge, weighted_indexes2)
merge <- rbind(merge, weighted_indexes3)
merge <- rbind(merge, weighted_indexes4)

#save this data
NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/weighted_Cscores.csv")
write.csv(merge,file=NAME)

#graph
plot <- ggplot(merge, aes(x=Year, y=Score, color = weighted_by)) +geom_line(size =1)+
  labs(y = "Mean Climate Change Index", title = "Climate Change Potential of Aquaculture")+
    theme(axis.text.x = element_text(size = 10), axis.title.y = element_text(size=10))+
      scale_color_manual(name = "Weighted By", values=c('#7D627F', '#7DBBC3', "pink", "orange", "lightgreen"))+
  ylim(30,65)

#SAVE
setwd("/Users/aleahw/Documents/Master's!!/Chapter_2/Figures")
# ggsave("C_weighted_combined.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set

```

```{r Graphing means in three time periods}

#modify dataset: create three time periods
scores_3_periods <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/weighted_Cscores.csv")
scores_3_periods <- scores_3_periods[, c(2:4)] #remove extra column

scores_3_periods$Year[scores_3_periods$Year >= 1950 & scores_3_periods$Year <= 1980] <- "1950-1980"
scores_3_periods$Year[scores_3_periods$Year >= 1981 & scores_3_periods$Year <= 2000] <- "1981-2000"
scores_3_periods$Year[scores_3_periods$Year >= 2001 & scores_3_periods$Year <= 2021] <- "2001-2021"

plot <- ggplot(scores_3_periods, aes(x = Year, y=Score, color = weighted_by))+ geom_boxplot()+
  stat_summary(fun.y=mean,geom='point', position = position_dodge(width = .75))+
  stat_summary(fun=mean, geom="line", aes(group=weighted_by), position = position_dodge(width = .75))+
  scale_x_discrete(limits = c("1950-1980", "1981-2000", "2001-2021"))+
  scale_y_continuous(limits = c(30, 67))+
  labs(y = "Mean Climate Index")+
    theme(axis.text.x = element_text(size = 10), axis.title.y = element_text(size=10))+
      scale_color_manual(name = "Weighted By", values=cbPalette)

setwd("/Users/aleahw/Documents/Master's!!/Chapter_2/Figures")
# ggsave("mean_C_boxplots.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set
```

####STEP 7: Weight biodiversity  scores by production ################
```{r BIODIV WEIGHTED BY ALL TAXA}
#calculate index scores for each species weighted by production of ALL 54 species

new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

#loop through each species and multiply b score by (production of that species/production of all species)
#cat_totals (production in THOUSANDS of tons) and speciesdata (f scores) align

for (i in 1:nrow(speciesdata)){ #for each species
  print(speciesdata$species[i])
  f_score <- speciesdata$b[i] #get the score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[1, b-1]) #weight by production of ALL species
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata[i, 2]#include species
  } 
  
}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes <- pivot_longer(weighted_indexes, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes <- weighted_indexes[order(weighted_indexes$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes)) {
  print(weighted_indexes$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes$Year[i] <- year_labs[i]
}

weighted_indexes$Year <- as.numeric(weighted_indexes$Year) #make years numeric

#Save data to graph weighted FCB together in Step 8
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweightedby_all.csv")
# write.csv(weighted_indexes,file=NAME)
```

```{r WEIGHTED BY FINFISH}
new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

#loop through each FINFISH species and multiply f score by (production of that species/production of all species)
#cat_totals (production in THOUSANDS of tons) and speciesdata (f scores) align

speciesdata2 <- filter(speciesdata, category == "finfish_inland" | category =="finfish_marine") #filter out just the finfish

production_data2 <- filter(production_data, category =="finfish_inland"| category =="finfish_marine")

for (i in 1:nrow(speciesdata2)){ #for each species
  f_score <- speciesdata2$b[i] #get the score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[2, b-1]) #weight by production of finfish
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  } 
  
}

#calculate the annual mean each year
for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes1 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes1 <- pivot_longer(weighted_indexes1, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes1 <- weighted_indexes1[order(weighted_indexes1$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes1)) {
  print(weighted_indexes1$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes1$Year[i] <- year_labs[i]
}

weighted_indexes1$Year <- as.numeric(weighted_indexes1$Year) #make years numeric

# SAVE this data to graph FCB together for finfish in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweightedby_finfish.csv")
# write.csv(weighted_indexes1,file=NAME)
```

```{r WEIGHTED BY ALGAE}

new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

#loop through each ALGAE species and multiply f score by (production of that species/production of all species)
#production_data (production in THOUSANDS of tons) and speciesdata (f scores) align

speciesdata2 <- filter(speciesdata, category == "algae") #filter out just the algae

production_data2 <- filter(production_data, category =="algae")

for (i in 1:nrow(speciesdata2)){ #for each species
  # print(speciesdata$species[i])
  f_score <- speciesdata2$b[i] #get the score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[4, b-1]) #weight by production of algae, row 4
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  } 
  
}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes2 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes2 <- pivot_longer(weighted_indexes2, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes2 <- weighted_indexes2[order(weighted_indexes2$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes2)) {
  print(weighted_indexes2$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes2$Year[i] <- year_labs[i]
}

weighted_indexes2$Year <- as.numeric(weighted_indexes2$Year) #make years numeric

# SAVE this data to graph FCB together for algae in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweightedby_algae.csv")
# write.csv(weighted_indexes2,file=NAME)
```

```{r WEIGHTED BY CRUSTACEANS}

new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

speciesdata2 <- filter(speciesdata, category == "crustacean")

production_data2 <- filter(production_data, category == "crustacean")

for (i in 1:nrow(speciesdata2)){ #for each species
  f_score <- speciesdata2$b[i] #get the b score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[5, b-1]) #weight by production of crustaceans, row 5
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  } 
  
}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes3 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes3 <- pivot_longer(weighted_indexes3, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes3 <- weighted_indexes3[order(weighted_indexes3$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes3)) {
  print(weighted_indexes3$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes3$Year[i] <- year_labs[i]
}

weighted_indexes3$Year <- as.numeric(weighted_indexes3$Year) #make years numeric

# SAVE this data to graph FCB together for crustaceans in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweightedby_crustaceans.csv")
# write.csv(weighted_indexes3,file=NAME)
```

```{r WEIGHTED BY MOLLUSCS}
new_frame <- frame #create new frame
new_frame <- frame[FALSE, ]

speciesdata2 <- filter(speciesdata, category == "mollusc")

production_data2 <- filter(production_data, category == "mollusc")

for (i in 1:nrow(speciesdata2)){ #for each species
  f_score <- speciesdata2$b[i] #get the b score
  
  for (b in 3:74){ #for each year
  index <- f_score*production_data2[i, b] #multiply score by that species' total production in each year
  index <- index/(weighting_totals[6, b-1]) #weight by production of molluscs, row 6
  
  new_frame[i, b-1] <- index   #add these numbers to the frame
  new_frame[i, 1] <- speciesdata2[i, 2]#include species
  } 
  
}

#calculate the annual mean each year

for (i in 2:73){
    a <- sum(new_frame[, i], na.rm = TRUE) #sum all the columns
    print(a)
    
    new_frame[58, i] <- a
}

new_frame[58, 1] <- "Weighted Index" #name the newest row
weighted_indexes4 <- new_frame[58, 2:73] #new frame with just the weighted scores each year

library(tidyr)
#make long
weighted_indexes4 <- pivot_longer(weighted_indexes4, cols = everything(), 
                                names_to = "Year", values_to = "Score")

weighted_indexes4 <- weighted_indexes4[order(weighted_indexes4$Year),] #put earlier years first

year_labs <- seq(1950, 2021, by = 1)

#rename year column in weighted_indexes
for (i in 1:nrow(weighted_indexes4)) {
  print(weighted_indexes4$Year[i])
  #replace each year with the actual year number from year_labs
  
  weighted_indexes4$Year[i] <- year_labs[i]
}

weighted_indexes4$Year <- as.numeric(weighted_indexes4$Year) #make years numeric

# SAVE this data to graph FCB together for molluscs in step 10
# NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweightedby_molluscs.csv")
# write.csv(weighted_indexes4,file=NAME)
```

```{r GRAPHING B}

#GRAPHING
#need to add identifier column
weighted_indexes$weighted_by <- "All"

#weighted_indexes1 = weighted by finfish
weighted_indexes1$weighted_by <- "Finfish"

#weighted_indexes2 = weighted by algae
weighted_indexes2$weighted_by <- "Algae"

#weighted_indexes3 = weighted by crustaceans
weighted_indexes3$weighted_by <- "Crustaceans"

#weighted_indexes4 = weighted by molluscs
weighted_indexes4$weighted_by <- "Molluscs"

#put into one dataframe, all stacked up
merge <- rbind(weighted_indexes, weighted_indexes1)
merge <- rbind(merge, weighted_indexes2)
merge <- rbind(merge, weighted_indexes3)
merge <- rbind(merge, weighted_indexes4)

#save this data
NAME<- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/weighted_Bscores.csv")
write.csv(merge,file=NAME)

#graph
ggplot(merge, aes(x=Year, y=Score, color = weighted_by)) +geom_line(size =1)+
  labs(y = "Mean Biodiversity Index", title = "Biodiversity Potential of Aquaculture")+
    theme(axis.text.x = element_text(size = 10), axis.title.y = element_text(size=10))+
      scale_color_manual(name = "Weighted By", values=c('#7D627F', '#7DBBC3', "pink", "orange", "lightgreen"))

#range 20-70?
#graph
plot <- ggplot(merge, aes(x=Year, y=Score, color = weighted_by)) +geom_line(size =1)+
  labs(y = "Mean Biodiversity Index", title = "Biodiversity Potential of Aquaculture")+
    theme(axis.text.x = element_text(size = 10), axis.title.y = element_text(size=10))+
      scale_color_manual(name = "Weighted By", values=c('#7D627F', '#7DBBC3', "pink", "orange", "lightgreen"))+
  ylim(30,70)

#SAVE
# ggsave("B_weighted_combined830.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set

```

```{r Graphing means in three time periods}
#magnitude of F, C and B indices by taxonomic group in three time periods

#modify dataset: create three time periods
# scores_3_periods <- merge
scores_3_periods <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/weighted_Bscores.csv")
scores_3_periods <- scores_3_periods[, c(2:4)] #remove extra column

scores_3_periods$Year[scores_3_periods$Year >= 1950 & scores_3_periods$Year <= 1980] <- "1950-1980"
scores_3_periods$Year[scores_3_periods$Year >= 1981 & scores_3_periods$Year <= 2000] <- "1981-2000"
scores_3_periods$Year[scores_3_periods$Year >= 2001 & scores_3_periods$Year <= 2021] <- "2001-2021"

plot <- ggplot(scores_3_periods, aes(x = Year, y=Score, color = weighted_by))+ geom_boxplot()+
  stat_summary(fun.y=mean,geom='point', position = position_dodge(width = .75))+
  stat_summary(fun=mean, geom="line", aes(group=weighted_by), position = position_dodge(width = .75))+
  scale_x_discrete(limits = c("1950-1980", "1981-2000", "2001-2021"))+
  scale_y_continuous(limits = c(30, 67))+
  labs(y = "Mean Biodiversity Index")+
    theme(axis.text.x = element_text(size = 10), axis.title.y = element_text(size=10))+
      scale_color_manual(name = "Weighted By", values=cbPalette)

# setwd("/Users/aleahw/Documents/Master's!!/Chapter_2/Figures")
# ggsave("mean_B_boxplots.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set
```

#STEP 8:Combining weighted F, C, B into one graph ########
```{r COMBINED FCB GRAPH WEIGHTED BY PRODUCTION OF ALL SPECIES}

#load in the data saved in steps 5-7
F_weighted_all <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweightedby_all.csv")
F_weighted_all <- F_weighted_all[, c(2:3)]
C_weighted_all <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweightedby_all.csv")
C_weighted_all <- C_weighted_all[, c(2:3)]
B_weighted_all <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweightedby_all.csv")
B_weighted_all <- B_weighted_all[, c(2:3)]

#Add FCB labels to each dataset before merging
F_weighted_all$Index <- "Food Security"
#weighted_indexesc = C weighted by all 
C_weighted_all$Index <- "Climate Change"
#weighted_indexesb = B weighted by all 
B_weighted_all$Index <- "Biodiversity"

#put into one dataframe, all stacked up
merge <- rbind(F_weighted_all, C_weighted_all)
merge <- rbind(merge, B_weighted_all)

#graph
# plot <- 
  ggplot(merge, aes(x=Year, y=Score, color = Index)) +geom_line(size =1)+
  labs(y = "Mean Index", title = "FCB Potential of Aquaculture Weighted by 54 Major Species")+
    theme(axis.text.x = element_text(size = 10), axis.title.y = element_text(size=10))+
      scale_color_manual(name = "Index", values=cbPalette)+
  ylim(48, 60)


#SAVE
# setwd("/Users/aleahw/Documents/Master's!!/Chapter_2/Figures")
# ggsave("FCB_weightedby_all.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set
```

###STEP 9: Correlations over time, run after Step 8 as F_weighted_all etc. rely on Step 8 code ###
```{r Finding correlations of FCB over time}

library(ggpubr)

#Merge by year
F_clean <- F_weighted_all[, -3]
colnames(F_clean)[2] = "Food_Security"

C_clean <- C_weighted_all[, -3]
colnames(C_clean)[2] = "Climate_Change"

B_clean <- B_weighted_all[, -3]
colnames(B_clean)[2] = "Biodiversity"

a <- merge(F_clean, C_clean, by="Year")
a <- merge(a, B_clean, by="Year")

#Save this dataset:
# NAME <- sprintf("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/yearlyFCBweightedall.csv")
# write.csv(a, file=NAME)

#Normality tests! --> Do the data from each of the 2 variables (x, y) follow a normal distribution?
# Use Shapiro-Wilk normality test –> R function: shapiro.test()
    # Null hypothesis: the data are normally distributed
    # Alternative hypothesis (p < 0.05): the data are not normally distributed
# Also, look at the normality plot —> R function: ggpubr::ggqqplot()

# Shapiro-Wilk normality test
shapiro.test(F_weighted_all$Score) # => NOT NORMAL; p-value = 0.00056
shapiro.test(C_weighted_all$Score) # NOT NORMAL; p = 0.006354
shapiro.test(B_weighted_all$Score) # NOT NORMAL; p = 0.04996

#Visual inspection of data normality using density plots and Q-Q plots (quantile-quantile plots). Density plots should show a bell-shaped distribution if data are normal. Q-Q plot draws the correlation between a given sample and the normal distribution.
ggdensity(F_weighted_all$Score, 
          main = "Density plot of F scores",
          xlab = "F score")
ggqqplot(F_weighted_all$Score) #NOT bell-shaped

ggdensity(C_weighted_all$Score, 
          main = "Density plot of C scores",
          xlab = "C score")
ggqqplot(C_weighted_all$Score) #NOT bell-shaped

ggdensity(B_weighted_all$Score, 
          main = "Density plot of B scores",
          xlab = "B score")
ggqqplot(B_weighted_all$Score) #NOT bell-shaped

#We assume a non-normal distribution, so we will use the Kendall rank correlation coefficient or Kendall’s tau statistic, which is used to estimate a rank-based measure of association.

cor.test(a$Food_Security, a$Climate_Change,  method="kendall") #tau = 0.6651017, p-value < 2.2e-16; F and C have a significantly positive correlation over time

cor.test(a$Food_Security, a$Biodiversity,  method="kendall") #tau = 0.5532081; p-value = 6.251e-12; F and B have a significantly positive correlation over time

cor.test(a$Biodiversity, a$Climate_Change,  method="kendall") #tau = 0.758216; p-value < 2.2e-16; B and C have a significantly positive correlation over time

```

```{r Finding FCB correlations before vs. after 2000}

#Correlations before and after 2000, since it appears that there may be some divergence by B

#load in data (this can be independent of above chunk)
yearlyFCBweightedall <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/yearlyFCBweightedall.csv")
yearlyFCBweightedall <- yearlyFCBweightedall[, c(2:5)] #remove extra column

#split dataset into three chunks. e.g., choose just years after 2000 in the dataset
before_BR <- filter(yearlyFCBweightedall, Year < 1980)
at_BR <- filter(yearlyFCBweightedall, Year > 1980 & Year < 2000)
after_BR <- filter(yearlyFCBweightedall, Year > 2000)

#correlations before the Blue Revolution (1950-1980)
cor.test(before_BR$Food_Security, before_BR$Climate_Change,  method="kendall") #Positively correlated; tau = 0.7517241; p-value = 3.452e-11
cor.test(before_BR$Food_Security, before_BR$Biodiversity,  method="kendall") #Positively correlated; tau = 0.7747126; p-value = 4.608e-12
cor.test(before_BR$Biodiversity, before_BR$Climate_Change,  method="kendall") #Positively correlated; tau = 0.7747126; p-value = 4.608e-12

#correlations during the Blue Revolution (1980-2000)
cor.test(at_BR$Food_Security, at_BR$Climate_Change,  method="kendall") #Positively correlated; tau = 0.7894737 ; p-value = 8.906e-08
cor.test(at_BR$Food_Security, at_BR$Biodiversity,  method="kendall") #Positively correlated; tau = 0.9532164  ; p-value = 1.172e-13
cor.test(at_BR$Climate_Change, at_BR$Biodiversity,  method="kendall") #Positively correlated; tau = 0.8128655   ; p-value = 2.379e-08

#correlations during the Blue Revolution (2000-2021)
cor.test(after_BR$Food_Security, after_BR$Climate_Change,  method="kendall") #Not correlated; tau = -0.0952381 ; p-value = 0.5706
cor.test(after_BR$Food_Security, after_BR$Biodiversity,  method="kendall") #Negatively correlated; tau = -0.6 ; p-value = 6.198e-05
cor.test(after_BR$Climate_Change, after_BR$Biodiversity,  method="kendall") #Weakly ositively correlated; tau =  0.3809524 ; p-value = 0.01568

```

###STEP 10: Graphing weighted FCB scores for each taxa #####
```{r Loading in data}
#load in this dataset to use as an empty frame, just species and year columns
frame <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/prodbytaxa_alphab.csv")
frame <- frame[, c(2:74)] #remove extra column

Fbyfinfish <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweightedby_finfish.csv")
Fbyfinfish <- Fbyfinfish[, c(2:3)] #remove extra column
Fbyalgae <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweightedby_algae.csv")
Fbyalgae <- Fbyalgae[, c(2:3)] #remove extra column
Fbymolluscs <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweightedby_molluscs.csv")
Fbymolluscs <- Fbymolluscs[, c(2:3)] #remove extra column
Fbycrust <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Fweightedby_crustaceans.csv")
Fbycrust <- Fbycrust[, c(2:3)] #remove extra column

Cbyfinfish <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweightedby_finfish.csv")
Cbyfinfish <- Cbyfinfish[, c(2:3)] #remove extra column
Cbyalgae <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweightedby_algae.csv")
Cbyalgae <- Cbyalgae[, c(2:3)] #remove extra column
Cbymolluscs <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweightedby_molluscs.csv")
Cbymolluscs <- Cbymolluscs[, c(2:3)] #remove extra column
Cbycrust <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Cweightedby_crustaceans.csv")
Cbycrust <- Cbycrust[, c(2:3)] #remove extra column

Bbyfinfish <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweightedby_finfish.csv")
Bbyfinfish <- Bbyfinfish[, c(2:3)] #remove extra column
Bbyalgae <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweightedby_algae.csv")
Bbyalgae <- Bbyalgae[, c(2:3)] #remove extra column
Bbymolluscs <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweightedby_molluscs.csv")
Bbymolluscs <- Bbymolluscs[, c(2:3)] #remove extra column
Bbycrust <- read.csv("/Users/aleahw/Documents/Master's!!/Chapter_2/Data/Bweightedby_crustaceans.csv")
Bbycrust <- Bbycrust[, c(2:3)] #remove extra column
```

```{r COMBINED FCB GRAPHS for each taxa}

#Add FCB labels to each dataset before merging
#FINFISH
Fbyfinfish$Index <- "Food Security"
Cbyfinfish$Index <- "Climate Change"
Bbyfinfish$Index <- "Biodiversity"
finfish_merge <- rbind(Fbyfinfish, Cbyfinfish)
finfish_merge <- rbind(finfish_merge, Bbyfinfish)

#ALGAE
Fbyalgae$Index <- "Food Security"
Cbyalgae$Index <- "Climate Change"
Bbyalgae$Index <- "Biodiversity"
algae_merge <- rbind(Fbyalgae, Cbyalgae)
algae_merge <- rbind(algae_merge, Bbyalgae)

#MOLLUSCS
Fbymolluscs$Index <- "Food Security"
Cbymolluscs$Index <- "Climate Change"
Bbymolluscs$Index <- "Biodiversity"
mollusc_merge <- rbind(Fbymolluscs, Cbymolluscs)
mollusc_merge <- rbind(mollusc_merge, Bbymolluscs)

#CRUSTACEANS
Fbycrust$Index <- "Food Security"
Cbycrust$Index <- "Climate Change"
Bbycrust$Index <- "Biodiversity"
crust_merge <- rbind(Fbycrust, Cbycrust)
crust_merge <- rbind(crust_merge, Bbycrust)

#################GRAPHING################
setwd("/Users/aleahw/Documents/Master's!!/Chapter_2/Figures")

#FINFISH
finfish <- ggplot(finfish_merge, aes(x=Year, y=Score, color = Index)) +geom_line(size =1)+
  # labs(y = "Mean Index", title = "FCB Potential of Aquaculture Weighted by Finfish")+
  theme_classic()+
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15),
          axis.title.x = element_blank(), axis.title.y = element_blank(),
          legend.title = element_text(size=15), legend.text = element_text(size = 15))+
      scale_color_manual(name = "Index", values=tolpalettesub)+
      scale_y_continuous(breaks = c(46, 48, 50, 52), limits = c(45, 54))+
        geom_vline(xintercept = 1980, linetype = "dashed")+ #vertical lines
        geom_vline(xintercept = 2000, linetype = "dashed")+
        geom_vline(xintercept = 2021, linetype = "dashed")+
          scale_x_continuous(breaks = c(1963, 1990, 2010), labels = c("I", "II", "III"))

        # ylim(45, 54)
# ggsave("FCB_weightedby_finfish.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set

#ALGAE
algae <- ggplot(algae_merge, aes(x=Year, y=Score, color = Index)) +geom_line(size =1)+
  # labs(y = "Mean Index", title = "FCB Potential of Aquaculture Weighted by Algae")+
  theme_classic()+
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15),
          axis.title.x = element_blank(), axis.title.y = element_blank(),
          legend.title = element_text(size=15), legend.text = element_text(size = 15))+
      scale_color_manual(name = "Index", values=tolpalettesub)+
      scale_y_continuous(breaks = c(55, 60, 65), limits = c(53, 67))+
        geom_vline(xintercept = 1980, linetype = "dashed")+ #vertical lines
        geom_vline(xintercept = 2000, linetype = "dashed")+
        geom_vline(xintercept = 2021, linetype = "dashed")+
          scale_x_continuous(breaks = c(1963, 1990, 2010), labels = c("I", "II", "III"))
        # ylim(53, 67)

# ggsave("FCB_weightedby_algae.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set

#MOLLUSCS
molluscs <- ggplot(mollusc_merge, aes(x=Year, y=Score, color = Index)) +geom_line(size =1)+
  # labs(y = "Mean Index", title = "FCB Potential of Aquaculture Weighted by Molluscs")+
  theme_classic()+
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15),
          axis.title.x = element_blank(), axis.title.y = element_blank(),
          legend.title = element_text(size=15), legend.text = element_text(size = 15))+
      scale_color_manual(name = "Index", values=tolpalettesub)+
      scale_y_continuous(breaks = c(45, 50, 55, 60, 65), limits = c(44, 66))+
        geom_vline(xintercept = 1980, linetype = "dashed")+ #vertical lines
        geom_vline(xintercept = 2000, linetype = "dashed")+
        geom_vline(xintercept = 2021, linetype = "dashed")+
          scale_x_continuous(breaks = c(1963, 1990, 2010), labels = c("I", "II", "III"))
  # ylim(44, 66)

# ggsave("FCB_weightedby_molluscs.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set

#CRUSTACEANS
crustaceans <- ggplot(crust_merge, aes(x=Year, y=Score, color = Index)) +geom_line(size =1)+
  # labs(y = "Mean Index", title = "FCB Potential of Aquaculture Weighted by Crustaceans")+
  theme_classic()+
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15),
          axis.title.x = element_blank(), axis.title.y = element_blank(),
          legend.title = element_text(size=15), legend.text = element_text(size = 15))+
      scale_color_manual(name = "Index", values=tolpalettesub)+
      scale_y_continuous(breaks = c(35, 40, 45, 50, 55), limits = c(30, 55))+
  # ylim(30, 55)+
        geom_vline(xintercept = 1980, linetype = "dashed")+ #vertical lines
        geom_vline(xintercept = 2000, linetype = "dashed")+
        geom_vline(xintercept = 2021, linetype = "dashed")+
          scale_x_continuous(breaks = c(1963, 1990, 2010), labels = c("I", "II", "III"))

# ggsave("FCB_weightedby_crustaceans.png", plot, height = 4, width = 8, dpi = 600) #make sure wd is set

```

```{r}
#facet graphs together

faceted <- (finfish|molluscs) / (algae|crustaceans) & theme(plot.margin = margin(5, 5, 7, 5))
# & xlab(NULL) & ylab(NULL) 
faceted <- faceted + plot_layout(guides = "collect")

faceted <- faceted + plot_annotation(tag_levels = 'a') & 
  theme(plot.tag = element_text(size = 15),
        plot.tag.position = c(0.04, 1.05))

faceted <- wrap_elements(panel = faceted) +
  labs(tag = "Mean Index") +
  theme(plot.tag = element_text(size = 20, angle = 90),
        plot.tag.position = "left")

faceted

ggsave("faceted_taxa_FCB.png", faceted, , units="in", width=10, height=6, dpi=600)
```


####STEP 11: Correlations of FCB in species ###
```{r}
library("ggpubr")
library(ggplot2)

# Shapiro-Wilk normality test
shapiro.test(speciesdata$f) # => NOT NORMAL; p-value = 0.01272
shapiro.test(speciesdata$c) # NORMAL; p-value = 0.07549
shapiro.test(speciesdata$b) # NOT NORMAL; p-value = 0.01598

#Visual inspection of data normality using density plots and Q-Q plots (quantile-quantile plots). Density plots should show a bell-shaped distribution if data are normal. Q-Q plot draws the correlation between a given sample and the normal distribution.
ggdensity(speciesdata$f, 
          main = "Density plot of F scores",
          xlab = "F score")
ggqqplot(speciesdata$f) #NOT bell-shaped

ggdensity(speciesdata$c, 
          main = "Density plot of C scores",
          xlab = "C score")
ggqqplot(speciesdata$c) #somewhat bell-shaped

ggdensity(speciesdata$b, 
          main = "Density plot of B scores",
          xlab = "B score")
ggqqplot(speciesdata$b) #NOT bell-shaped

#Spearman rank correlation, assuming non-normal dist
# The Kendall rank correlation coefficient or Kendall’s tau statistic is used to estimate a rank-based measure of association. This production_data may be used if the data do not necessarily come from a bivariate normal distribution.

cor.test(speciesdata$f, speciesdata$c,  method="kendall") #SIG; tau = 0.4148244, p-value = 6.497e-06

cor.test(speciesdata$f, speciesdata$b,  method="kendall") #SIG; tau = 0.3690207; p-value = 6.122e-05

cor.test(speciesdata$c, speciesdata$b,  method="kendall") #SIG; tau = 0.3169543; p-value = 0.0005763
```